(()=>{"use strict";let t=[];const e="http://localhost:3000";async function n(){const n=await async function(){const t=e.concat("/api/columns");try{const e=await fetch(t);if(!e.ok)throw new Error(`Response status: ${e.status}`);return await e.json()}catch(t){return t instanceof Error&&console.error(t.message),[]}}();t.length=0,t.push(...n)}const o="http://localhost:3000";async function s(t,e){const n=o.concat(`/api/columns/${t}/reorder`);try{const t=await fetch(n,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:e})});if(!t.ok)throw new Error(`Error updating task order: ${t.statusText}`)}catch(t){t instanceof Error&&console.error("updateTaskOrder: ",t)}}let c=null,a=null;function i(){const t=document.querySelectorAll(".column");t&&Array.isArray(t)&&t.forEach((t=>{t.addEventListener("dragover",(t=>function(t){t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="move");const e=t.currentTarget,n=document.querySelector(".dragging");if(n){const o=function(t,e){const n=Array.prototype.slice.call(t.querySelectorAll(".task:not(.dragging)"));for(const t of n){const n=t.getBoundingClientRect();if(e-n.top-n.height/2<0)return t}return null}(e,t.clientY);o&&o!==a?o.insertAdjacentElement("beforebegin",n):o||e.lastElementChild===a||e.appendChild(n)}}(t))),t.addEventListener("dragenter",(t=>function(t){t.currentTarget.classList.add("over")}(t))),t.addEventListener("dragleave",(t=>function(t){t.currentTarget.classList.remove("over")}(t))),t.addEventListener("drop",(t=>function(t){var e;t.preventDefault();const n=null===(e=t.dataTransfer)||void 0===e?void 0:e.getData("text/plain");let o;n&&(o=document.getElementById(n));t.currentTarget.classList.remove("over")}(t)))}))}function d(e){if(e._id){const n=document.getElementById(e._id);if(!n)return;const i=n.closest(".column");i&&n.setAttribute("data-column-id",i.id),n.addEventListener("dragstart",(t=>async function(t,e){const n=t.currentTarget;t.dataTransfer&&(t.dataTransfer.effectAllowed="move",e._id&&t.dataTransfer.setData("taskId",e._id));const o=t.currentTarget.closest(".column");e._id&&(c=o.id),n.classList.add("dragging"),a=document.createElement("div"),a.classList.add("placeholder"),a.style.height=`${n.offsetHeight}px`}(t,e))),n.addEventListener("dragend",(n=>async function(e,n){const i=document.querySelector(".dragging");if(i&&a){const d=e.currentTarget.closest(".column");if(d&&c){const e=d.id,a=t.findIndex((t=>t._id===d.id));if(n._id){const r=d.querySelectorAll(".task");let l=Array.from(r).indexOf(i);if(-1!==l)if(c===e){if(n._id){const o=t[a].tasks.findIndex((t=>t._id===n._id));t[a].tasks.splice(o,1),t[a].tasks.splice(l,0,{title:n.title,description:n.description,_id:n._id}),await s(e,t[a].tasks)}}else t[a].tasks.splice(l,0,{title:n.title,description:n.description,_id:n._id}),await async function(t,e,n){const s=o.concat("/api/columns/moveTask");try{const o=await fetch(s,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceColumnId:t,targetColumnId:e,taskId:n})});if(!o.ok)throw new Error(`Error moving task: ${o.statusText}`)}catch(t){console.error("Error moving task:",t)}}(c,e,n._id),await s(e,t[a].tasks)}}a.replaceWith(i),i.classList.remove("dragging"),a=null}}(n,e)))}}function r(t){if(t._id){const e=document.getElementById(t._id);if(!e)return;const n=e.closest(".column");n&&e.setAttribute("data-column-id",n.id);const o=e.cloneNode(!0);e.replaceWith(o)}}function l(e){const n=document.createElement("div");n.classList.add("task","item"),n.setAttribute("draggable","true"),e._id&&(n.id=e._id);const s=document.createElement("div");s.classList.add("taskHeader");const c=document.createElement("div");c.classList.add("taskTitle"),c.textContent=e.title;const a=document.createElement("div");a.classList.add("menuDots"),a.innerHTML="⋮",a.setAttribute("draggable","false"),s.appendChild(c),s.appendChild(a);const i=document.createElement("div");return i.classList.add("taskDescription"),i.textContent=e.description,n.appendChild(s),n.appendChild(i),d(e),function(e,n,s,c){e.onclick=()=>{let a=e.querySelector(".menuDialog");if(a)a.style.display="block"===a.style.display?"none":"block";else{a=document.createElement("div"),a.classList.add("menuDialog");const e=document.createElement("h2");e.textContent="Column dialog",a.appendChild(e);const i=document.createElement("button");i.innerHTML="Edit title",a.appendChild(i),i.onclick=()=>{n.innerHTML="";const e=document.createElement("input");e.type="text",e.value=n.textContent||"",n.appendChild(e),e.focus();const s=async()=>{n.textContent=e.value,a.style.display="none";const s=c.parentElement;if(s){const n=s.id,a=t.findIndex((t=>t._id===n));if(-1!==a){const n=c.id;if(n){await async function(t,e,n){const s=o.concat(`/api/columns/${t}/tasks/${e}`);try{const t=await fetch(s,{method:"PATCH",headers:{"Content-type":"application/json"},body:JSON.stringify({title:n})});if(!t.ok)throw new Error(`Failed to update task title. Server responded with ${t.status}`)}catch(t){t instanceof Error&&console.error(t)}}(s.id,n,e.value);const c=t[a].tasks.findIndex((t=>t._id===n));r(t[a].tasks[c]),d(t[a].tasks[c])}}}},i=document.createElement("button");i.textContent="Save",a.appendChild(i),i.onclick=s,e.addEventListener("keypress",(t=>{"Enter"===t.key&&s()}))};const l=document.createElement("button");l.innerHTML="Edit desc",a.appendChild(l),l.onclick=()=>{s.innerHTML="";const e=document.createElement("input");e.type="text",e.value=s.textContent||"",s.appendChild(e),e.focus();const n=()=>{s.textContent=e.value,a.style.display="none";const n=c.parentElement;if(n){const s=n.id;!async function(t,e,n){const s=o.concat(`/api/columns/${t}/tasks/${e}`);try{const t=await fetch(s,{method:"PATCH",headers:{"Content-type":"application/json"},body:JSON.stringify({description:n})});if(!t.ok)throw new Error(`Failed to update task description. Server responded with ${t.status}`)}catch(t){t instanceof Error&&console.error(t)}}(n.id,c.id,e.value);const a=t.findIndex((t=>t._id===s));if(-1!==a){const e=c.id;if(e){const n=t[a].tasks.findIndex((t=>t._id===e));r(t[a].tasks[n]),d(t[a].tasks[n])}}}},i=document.createElement("button");i.textContent="Save",a.appendChild(i),i.onclick=n,e.addEventListener("keypress",(t=>{"Enter"===t.key&&n()}))};const u=document.createElement("button");u.innerHTML="Delete task",a.appendChild(u),u.onclick=async()=>{const e=c.parentElement;if(e){const n=e.id;if(-1!==t.findIndex((t=>t._id===n))){const t=c.id;if(t){!async function(t,e){const n=o.concat(`/api/columns/${t}/tasks/${e}`);try{const t=await fetch(n,{method:"DELETE",headers:{"Content-type":"application/json"}});if(!t.ok)throw new Error(`Error deleting the task: ${t.status}`)}catch(t){t instanceof Error&&console.log(t)}}(e.id,t);const n=document.getElementById(t);n&&n.remove()}}}}}e.appendChild(a)}}(a,c,i,n),n}function u(n){const o=document.getElementById("itemContainer");if(!o)return void console.error("Item container not found");const s=document.createElement("div");s.classList.add("column");const c=n._id;c&&(s.id=c);const a=document.createElement("div");a.classList.add("columnTitle"),a.textContent=n.title;const d=document.createElement("div");d.classList.add("menuDots"),d.innerHTML="⋮",d.onclick=()=>{let o=d.querySelector(".menuDialog");if(o)o.style.display="block"===o.style.display?"none":"block";else{o=document.createElement("div"),o.classList.add("menuDialog");const s=document.createElement("h2");s.textContent="Column dialog",o.appendChild(s);const c=document.createElement("button");c.innerHTML="Edit",c.onclick=()=>{a.innerHTML="";const s=document.createElement("input");s.type="text",s.value=a.textContent||"",a.appendChild(s),s.focus();const c=document.createElement("button");c.textContent="Save",o.appendChild(c),c.onclick=()=>{a.textContent=s.value,o.style.display="none";const c=t.findIndex((t=>t._id===n._id));n._id&&async function(t,n){const o=e.concat(`/api/columns/${t}`);try{const t=await fetch(o,{method:"PATCH",headers:{"Content-type":"application/json"},body:JSON.stringify({title:n})});if(!t.ok)throw new Error(`Failed to add column. Server responded with ${t.status}`)}catch(t){t instanceof Error&&console.error(t)}}(n._id,s.value),-1!==c&&t.splice(c,1,Object.assign(Object.assign({},t[c]),{title:s.value}))},s.addEventListener("keypress",(e=>{if("Enter"===e.key){a.textContent=s.value,o.style.display="none";const e=t.findIndex((t=>t._id===n._id));-1!==e&&t.splice(e,1,Object.assign(Object.assign({},t[e]),{title:s.value}))}}))};const i=document.createElement("button");i.innerHTML="Delete",i.onclick=async()=>{if(t.findIndex((t=>t._id===n._id)),n._id){await async function(t){const n=e.concat(`/api/columns/${t}`);try{const t=await fetch(n,{method:"DELETE",headers:{"Content-type":"application/json"}});t.ok||console.error(`Error deleting column: ${t.status}`)}catch(t){t instanceof Error&&console.log(t)}}(n._id);const t=document.getElementById(n._id);t&&t.remove()}},o.appendChild(c),o.appendChild(i),d.appendChild(o),o.style.display="block",o.onclick=t=>{t.stopPropagation()}}};const r=document.createElement("div");r.classList.add("columnTitleContainer"),r.appendChild(a),r.appendChild(d),s.appendChild(r),n.tasks&&Array.isArray(n.tasks)&&n.tasks.forEach((t=>{const e=l(t);s.appendChild(e)})),o.appendChild(s),i()}function p(){const o=document.createElement("div");o.id="dialog",o.className="dialog";const s=document.createElement("div");s.className="dialog-content";const c=document.createElement("span");c.className="close",c.textContent="x",c.onclick=()=>{o.remove()};const a=document.createElement("h2");a.textContent="Add New Column";const i=document.createElement("label");i.setAttribute("for","columnTitle"),i.textContent="Title:";const d=document.createElement("input");d.type="text",d.placeholder="Enter column title";const r=document.createElement("button");r.textContent="Submit",r.onclick=()=>async function(o){const s=o.value;if(o&&s){const o={title:s,tasks:[]};await async function(t){const n=e.concat("/api/columns");try{const e=await fetch(n,{method:"POST",headers:{"Content-type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`Server error: ${e.status}`)}catch(t){t instanceof Error&&console.error("Error posting column: ",t.message)}}(o),await n();const c=t.find((t=>t.title===s));if(!c)return console.log("Column does not exist: ",c),null;u(c)}else console.error("Title cannot be empty");o&&(o.value="");const c=document.getElementById("dialog");c?c.remove():console.error("Dialog not found!")}(d),s.appendChild(c),s.appendChild(a),s.appendChild(i),s.appendChild(d),s.appendChild(r),o.appendChild(s),document.body.appendChild(o),d.value="",o.style.display="block"}async function m(){const e=document.createElement("div");e.id="dialog",e.className="dialog";const o=document.createElement("div");o.className="dialog-content";const s=document.createElement("span");s.className="close",s.textContent="x",s.onclick=()=>{e.remove()};const c=document.createElement("h2");c.textContent="Add New Task";const a=document.createElement("label");a.setAttribute("for","taskTitle"),a.textContent="Title:";const r=document.createElement("input");r.type="text",r.id="taskTitle",r.placeholder="Enter task title";const u=document.createElement("label");u.setAttribute("for","taskDescription"),u.textContent="Description:";const p=document.createElement("input");p.type="text",p.id="taskDescription",p.placeholder="Enter task description";const m=document.createElement("div");m.textContent="Select Column:";const f=document.createElement("select");f.id="columnSelect",t&&Array.isArray(t)&&t.forEach((t=>{const e=document.createElement("option");t._id&&(e.value=t._id,e.textContent=t.title,f.appendChild(e))}));const h=document.createElement("button");h.textContent="Submit",h.onclick=()=>async function(e,o,s){const c=document.getElementById(e);if(!c)return console.error("columnElement is null:",c),null;try{const a=await(async(t,e,n)=>{try{const o=await fetch(`/api/columns/${t}/tasks`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,description:n})});if(!o.ok)throw new Error(`Failed to add task: ${o.statusText}`);const s=await o.json();return s.success&&s.task?{success:!0,message:"Task added",task:s.task}:(console.log(s.message||"Failed to add task!"),{success:!1,message:s.message||"Failed to add task"})}catch(t){return console.error(t),{success:!1,message:"Failed to add task!"}}})(e,o,s);if(!a.success||!a.task)return console.error(a.message),null;const r=a.task._id;await n();const u=t.find((t=>t._id===e));if(!u)return console.error(`Column with ID ${e} not found`),null;const p=u.tasks.find((t=>t._id===r));if(!p)return console.error("Task not found!"),null;const m=l(p);c.appendChild(m),i(),d(p);const f=document.getElementById("dialog");return f?f.remove():console.error("Dialog not found!"),m}catch(t){return console.error("Error adding task:",t),null}}(f.value,r.value,p.value),o.appendChild(s),o.appendChild(c),o.appendChild(a),o.appendChild(r),o.appendChild(u),o.appendChild(p),o.appendChild(m),o.appendChild(f),o.appendChild(h),e.appendChild(o),document.body.appendChild(e),e.style.display="block"}window.onload=async()=>{await n(),i(),t&&Array.isArray(t)&&t.forEach((t=>{u(t),t.tasks.forEach((t=>d(t)))})),window.addColumn=p,window.addTask=m}})();
//# sourceMappingURL=main.bundle.js.map